<div class="card w-full flex flex-column gap-3">
  <div class="flex container-search justify-content-between align-items-center mb-3">
  <h3 class="m-0">Categories</h3>

  <span class="p-input-icon-left">
    <p-inputgroup>
    <input
      pInputText
      type="text"
      (input)="onGlobalFilter($event)"
      placeholder="Search Category..."
      class="p-inputtext-sm"
    />
    <p-inputgroup-addon>
        <p-button icon="pi pi-search" severity="secondary" variant="text" />
    </p-inputgroup-addon>
</p-inputgroup>
  </span>
</div>
  <p-table   *ngIf="courses && (courses | keyvalue) as categories"
  [value]="categories"
  [paginator]="true"
  [rows]="5"
  stripedRows
  class="p-table"
  #dt
  [globalFilterFields]="['key']">
    <ng-template pTemplate="header">
      <tr>
        <th>Category</th>
        <th>Courses</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-category>
      <tr>
        <td class="font-bold">{{ category.key }}</td>
        <td>
          <div class="flex gap-2">
            <p-tag *ngFor="let course of category.value.value"
                   [value]="course.name"
                   severity="info">
            </p-tag>
          </div>
        </td>
        <td class="flex gap-2">
          <p-button icon="pi pi-pencil"
                    class="col-6 p-0"
                    severity="info"
                    (click)="openEditDialog(category)">
          </p-button>

          <p-button *ngIf="isAdmin"
                    icon="pi pi-trash"
                    class="col-6 p-0"
                    severity="danger"
                    (click)="openDeleteCategoryFromDB(category.key)">
          </p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>


<p-dialog
  header="Edit Category"
  [(visible)]="isEditDialogVisible"
  [modal]="true"
  [closable]="true"
  [dismissableMask]="true"
  styleClass="custom-dialog-width">

  <form [formGroup]="editForm" class="w-full">

    <!-- Category Title -->
    <label for="categoryTitle" class="block mb-2 font-bold">Category Title</label>
    <input id="categoryTitle"
           pInputText
           formControlName="title"
           placeholder="Enter category title"
           class="w-full mb-3" />

    <!-- Courses -->
    <label class="block mb-2 font-bold">Courses</label>
    <div formArrayName="courses">
      <div *ngFor="let courseCtrl of coursesArray.controls; let i = index" class="flex gap-2 mb-2">

        <input pInputText
               [formControlName]="i"
               [attr.placeholder]="'Enter course name ' + (i + 1)"
               class="w-full" />

        <p-button icon="pi pi-trash"
                  *ngIf="isAdmin"
                  (click)="deleteCourse(i)"
                  severity="danger"></p-button>
      </div>
    </div>

    <p-button label="Add Course"
              icon="pi pi-plus"
              (click)="addCourse()"
              class="col-6 mt-3 p-0 flex"
              severity="info"></p-button>
  </form>

  <ng-template pTemplate="footer">
    <p-button label="Cancel"
              icon="pi pi-times"
              (click)="cancelEdit()"
              severity="secondary"></p-button>
    <p-button label="Save"
              icon="pi pi-check"
              [disabled]="editForm.invalid"
              (click)="saveUpdatedCategory()"
              severity="success"></p-button>
  </ng-template>
</p-dialog>

<p-dialog
  header="Delete Category"
  [(visible)]="isDeleteDialogVisible"
  [modal]="true"
  [closable]="true"
  [dismissableMask]="true"
  styleClass="custom-dialog-width"
>

  <div class="flex gap-3 pt-4 justify-content-center flex-column align-items-center">
    <i class="fa-solid fa-triangle-exclamation fa-xl text-red-500"></i>
    <h3 class="text-center">Are you sure you want to delete this category: <b>{{ selectedCategory }}</b> ?</h3>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex gap-3 justify-content-center align-items-center w-full">
      <p-button label="Cancel"
        icon="pi pi-times"
        severity="secondary"
        (click)="cancelDelete()" />
      <p-button label="Delete"
        icon="pi pi-trash"
        severity="danger"
        (click)="deleteCategoryFromDB(selectedCategory)" />
    </div>
  </ng-template>
</p-dialog>
